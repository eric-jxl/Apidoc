<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>交接文档 | Eric&#39;s Docs</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/vim-go.png">
    <meta name="description" content="Vue 驱动的静态网站生成器">
    
    <link rel="preload" href="/assets/css/0.styles.e8e4f3a3.css" as="style"><link rel="preload" href="/assets/js/app.449b22a3.js" as="script"><link rel="preload" href="/assets/js/2.559d5401.js" as="script"><link rel="preload" href="/assets/js/15.ec9227b5.js" as="script"><link rel="prefetch" href="/assets/js/10.726bd935.js"><link rel="prefetch" href="/assets/js/11.e79855c3.js"><link rel="prefetch" href="/assets/js/12.47f2790b.js"><link rel="prefetch" href="/assets/js/13.417251e4.js"><link rel="prefetch" href="/assets/js/14.3edae8b6.js"><link rel="prefetch" href="/assets/js/16.26fb3b70.js"><link rel="prefetch" href="/assets/js/17.29790a45.js"><link rel="prefetch" href="/assets/js/18.b0df4d31.js"><link rel="prefetch" href="/assets/js/19.bc5e31dd.js"><link rel="prefetch" href="/assets/js/20.b2d6c07e.js"><link rel="prefetch" href="/assets/js/21.a977319a.js"><link rel="prefetch" href="/assets/js/22.6b11c997.js"><link rel="prefetch" href="/assets/js/23.6addca62.js"><link rel="prefetch" href="/assets/js/24.8f666926.js"><link rel="prefetch" href="/assets/js/3.e9d031a5.js"><link rel="prefetch" href="/assets/js/4.f16d5533.js"><link rel="prefetch" href="/assets/js/5.905f59dc.js"><link rel="prefetch" href="/assets/js/6.2f60c27c.js"><link rel="prefetch" href="/assets/js/7.12fb85ab.js"><link rel="prefetch" href="/assets/js/8.047bdcbd.js"><link rel="prefetch" href="/assets/js/9.a153bdbb.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e8e4f3a3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/vim-go.png" alt="Eric's Docs" class="logo"> <span class="site-name can-hide">Eric's Docs</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Guide" class="dropdown-title"><span class="title">Guide</span> <span class="arrow down"></span></button> <button type="button" aria-label="Guide" class="mobile-dropdown-title"><span class="title">Guide</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          超高清能力
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/超高清能力/交接文档.html" class="nav-link">
  交接文档
</a></li><li class="dropdown-subitem"><a href="/超高清能力/搬迁组件说明文档.html" class="nav-link">
  搬迁文档
</a></li><li class="dropdown-subitem"><a href="/超高清能力/Dvadmin 接口.html" class="nav-link">
  Dvadmin接口
</a></li><li class="dropdown-subitem"><a href="/超高清能力/RD报告接口文档.html" class="nav-link">
  RD报告接口文档
</a></li></ul></li><li class="dropdown-item"><h4>
          运维部署
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/运维部署/Docker.html" class="nav-link">
  Docker
</a></li></ul></li><li class="dropdown-item"><h4>
          面经
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/面试/面经.html" class="nav-link">
  面经
</a></li></ul></li><li class="dropdown-item"><h4>
          odoo
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/odoo/odoo核心业务.html" class="nav-link">
  odoo核心业务
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="https://github.com/eric-jxl/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/eric-jxl/docs.git" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Guide" class="dropdown-title"><span class="title">Guide</span> <span class="arrow down"></span></button> <button type="button" aria-label="Guide" class="mobile-dropdown-title"><span class="title">Guide</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          超高清能力
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/超高清能力/交接文档.html" class="nav-link">
  交接文档
</a></li><li class="dropdown-subitem"><a href="/超高清能力/搬迁组件说明文档.html" class="nav-link">
  搬迁文档
</a></li><li class="dropdown-subitem"><a href="/超高清能力/Dvadmin 接口.html" class="nav-link">
  Dvadmin接口
</a></li><li class="dropdown-subitem"><a href="/超高清能力/RD报告接口文档.html" class="nav-link">
  RD报告接口文档
</a></li></ul></li><li class="dropdown-item"><h4>
          运维部署
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/运维部署/Docker.html" class="nav-link">
  Docker
</a></li></ul></li><li class="dropdown-item"><h4>
          面经
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/面试/面经.html" class="nav-link">
  面经
</a></li></ul></li><li class="dropdown-item"><h4>
          odoo
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/odoo/odoo核心业务.html" class="nav-link">
  odoo核心业务
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="https://github.com/eric-jxl/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/eric-jxl/docs.git" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>超高清能力</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/超高清能力/搬迁组件说明文档.html" class="sidebar-link">搬迁组件说明文档</a></li><li><a href="/超高清能力/交接文档.html" class="active sidebar-link">交接文档</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/超高清能力/DTing VQMT VQA部署常见问题.html" class="sidebar-link">DTing VQMT VQA部署常见问题</a></li><li><a href="/超高清能力/Dvadmin 接口.html" class="sidebar-link">标签</a></li><li><a href="/超高清能力/RD报告接口文档.html" class="sidebar-link">RD 报告 API 文档</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>运维部署</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/运维部署/Docker.html" class="sidebar-link">Docker</a></li><li><a href="/运维部署/Golang Ubuntu安装及配置.html" class="sidebar-link">Golang Ubuntu安装及配置</a></li><li><a href="/运维部署/Jupyter 远程配置.html" class="sidebar-link">Jupyter 远程配置</a></li><li><a href="/运维部署/nacos安装指南.html" class="sidebar-link">nacos安装指南</a></li><li><a href="/运维部署/RedisDoc.html" class="sidebar-link">Redis 安装与配置</a></li><li><a href="/运维部署/Ubuntu部署.html" class="sidebar-link">Ubuntu 部署nginx、生成泛域名证书</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>odoo</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/odoo/巡检任务接口.html" class="sidebar-link">巡检任务查询接口</a></li><li><a href="/odoo/odoo核心业务.html" class="sidebar-link">核心业务</a></li><li><a href="/odoo/Odoo及Postgresql.html" class="sidebar-link">Odoo及Postgresql</a></li><li><a href="/odoo/odooconf.html" class="sidebar-link">Odoo Sever Config</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="交接文档"><a href="#交接文档" class="header-anchor">#</a> 交接文档</h1> <h3 id="预算"><a href="#预算" class="header-anchor">#</a> 预算</h3> <p>Moudule:rh_account_budget</p> <p>1.<code>conf</code></p> <div class="language- extra-class"><pre><code>存放redis配置文件
</code></pre></div><p>2.<code>contrlollers</code></p> <p>​	==main.py==  class SyncBudgetReport:</p> <p>​	Route:/api/get_crossovered_budget  : 预算汇总情况  返回:<code>json</code></p> <p>​	Route:/api/get_account_budget_post: 预算状况汇总表</p> <p>3.<code>lib</code></p> <p>​	==jwt_utils.py== :封装接口加密机制</p> <p>​</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> sha256base64
<span class="token comment">#密钥加密算法</span>
<span class="token keyword">def</span> verify_token
<span class="token comment">#校验token装饰器</span>
</code></pre></div><p>​	 ==redislib.py== ：封装了所有redis的连接池和接口</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">ExportRedis</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">insert_redis_queue</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> queue<span class="token punctuation">,</span> params_dict<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">'''由左向右👉插入List'''</span>
        self<span class="token punctuation">.</span>cursor<span class="token punctuation">.</span>lpush<span class="token punctuation">(</span>queue<span class="token punctuation">,</span> json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>params_dict<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">rpop_redis_queue</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> queue<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">'''从右向左弹出 return []'''</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>cursor<span class="token punctuation">.</span>rpop<span class="token punctuation">(</span>queue<span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">range_queue</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> queue<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 查询列表中所有的键值</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>cursor<span class="token punctuation">.</span>lrange<span class="token punctuation">(</span>queue<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
</code></pre></div><ol start="4"><li><p><code>Models</code></p> <p>==account_budget_modify.py==:主要功能点：表：==crossovered.budget.lines==预算明细表</p> <p>planned_amount  计划金额 practical_amount 实际金额  ==new_practical_amount==  根据practical_amount实际金额write回填    balance 余额。show_color ：控制列表变红</p> <p>done_per 完成率</p> <p>==def _compute_practical_amount== 计算实际金额，根据分析账户明细中 该分析账户在日期区间内有的<code>预算状况</code> 进行SUM计算</p> <p>==budget_hr_expense.py== ：继承hr.expense.sheet 对费用单据进行预算超支<code>预警弹出框</code>,在do_sumbit和do_approved 取预算的余额和当前在待批和完成的单据发生额进行比较，==超的明细行变红并且弹出提示框==</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">HrExpense</span>
module_budget_installed <span class="token comment">#检查预算模块是否安装，有分析账户必填</span>
excess_color  <span class="token comment">#计算字段 compute_excess_color</span>
	<span class="token keyword">def</span> <span class="token function">compute_module_budget_installed</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> record <span class="token keyword">in</span> self<span class="token punctuation">:</span>
            module <span class="token operator">=</span> self<span class="token punctuation">.</span>env<span class="token punctuation">[</span><span class="token string">'ir.module.module'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>sudo<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'='</span><span class="token punctuation">,</span> 		<span class="token string">'rh_account_budget'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> record<span class="token punctuation">.</span>payment_mode <span class="token operator">==</span> <span class="token string">'own_account'</span><span class="token punctuation">:</span> <span class="token comment">#属于报销类型</span>
              <span class="token comment">#  下面根据情况分预算内/预算外</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span> <span class="token comment">#自动扣款</span>
                record<span class="token punctuation">.</span>module_budget_installed <span class="token operator">=</span> <span class="token boolean">False</span>
     
	<span class="token keyword">def</span>  compute_excess_color <span class="token comment">#控制明细行变红</span>
    
    <span class="token keyword">def</span> action_to_analytic_form：<span class="token comment">#跳转到对应的分析账户界面</span>
    
    <span class="token keyword">def</span> edit_expense_line_analytic <span class="token punctuation">:</span><span class="token comment">#修改分析账户上analytic_account_id</span>
        
</code></pre></div><p>==inherit_analytic_account.py== ：对分析账户功能继承</p> <p>​	<code>department_ids</code>：部门  <code>user_ids</code>：员工    <code>department_user_ids</code>：部门下的员工</p> <p>​	根据部门选择下属员工可见，或者直接选择员工，限制记录规则</p> <p>​	def compute_user_ids :计算部门的员工</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment">#重写分组函数。用来计算预算的实际金额、占用金额、余额</span>
<span class="token keyword">def</span> <span class="token function">read_group</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> domain<span class="token punctuation">,</span> fields<span class="token punctuation">,</span> groupby<span class="token punctuation">,</span> offset<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> limit<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> orderby<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> lazy<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        res <span class="token operator">=</span> <span class="token builtin">super</span><span class="token punctuation">(</span>AccountAnalyticAccount<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>read_group<span class="token punctuation">(</span>domain<span class="token punctuation">,</span> fields<span class="token punctuation">,</span> groupby<span class="token punctuation">,</span> offset<span class="token operator">=</span>offset<span class="token punctuation">,</span> limit<span class="token operator">=</span>limit<span class="token punctuation">,</span>
                                                             orderby<span class="token operator">=</span>orderby<span class="token punctuation">,</span> lazy<span class="token operator">=</span>lazy<span class="token punctuation">)</span>
        <span class="token keyword">for</span> r <span class="token keyword">in</span> res<span class="token punctuation">:</span>
            domain <span class="token operator">=</span> r<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'__domain'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            records <span class="token operator">=</span> self<span class="token punctuation">.</span>search<span class="token punctuation">(</span>domain<span class="token punctuation">)</span>
            r<span class="token punctuation">[</span><span class="token string">'budget_planned_amount'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>records<span class="token punctuation">.</span>mapped<span class="token punctuation">(</span><span class="token string">'budget_planned_amount'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token number">0.0</span>
            r<span class="token punctuation">[</span><span class="token string">'budget_amount'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>records<span class="token punctuation">.</span>mapped<span class="token punctuation">(</span><span class="token string">'budget_amount'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token number">0.0</span>
            r<span class="token punctuation">[</span><span class="token string">'budget_balance'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>records<span class="token punctuation">.</span>mapped<span class="token punctuation">(</span><span class="token string">'budget_balance'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token number">0.0</span>
            r<span class="token punctuation">[</span><span class="token string">'occupy_amount'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>records<span class="token punctuation">.</span>mapped<span class="token punctuation">(</span><span class="token string">'occupy_amount'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token number">0.0</span> <span class="token comment">#占用金额</span>

        <span class="token keyword">return</span> res
    
<span class="token keyword">def</span> <span class="token function">summary_analytic_records</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment">#计算该分析账户关联的费用单据的发生额</span>
<span class="token keyword">def</span> <span class="token function">click_details_windows</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token comment">#跳转按钮，嵌套上面的方法，每次点击删除旧纪录，生成新纪录，筛选当前的分析账户</span>
</code></pre></div><p>​</p></li> <li><p><code>wizard</code></p> <p>临时表提供向导功能</p> <p>==wizard_analysis_examine_details.py== 分析账户使用的详情</p> <p>==wizard_batch_dept_users.py==:更新部门下的员工</p> <p>==wizard_edit_expense_line_analytic.py==：修改分析账户明细行</p> <p>==wizard_hr_expense_sheet_budget.py==:费用审批和提交。判断是否超支金蝶</p></li></ol> <h3 id="金蝶"><a href="#金蝶" class="header-anchor">#</a> 金蝶</h3> <p><code>Module</code>:rh_kingdee_port</p> <ol><li><p>Data:<code>kingdee_ir_corn.xml</code>：定时任务：<code>费用单据推送账无忧</code>,<code>收付款单据推送账无忧</code>,<code>内部转账单据推送账无忧</code></p> <p><code>kingdee_setting.yml</code>：自动创建金蝶配置参数</p></li></ol> <p>2.Lib：</p> <p>​		<code>redislib.py</code>: def handle_redis_token存储设置token的有效时长为4小时，过期自动删除</p> <p>​	3.Models:</p> <p>​		==rh_kingdee_port.py==集成金蝶所有模型和接口</p> <p>​		==rh_kingdee_send_logs.py==：金蝶同步日志</p> <p>​		==account_payment_interface.py==：集成收付款推送功能</p> <p>​		==inhert_hr_sheet.py==：费用推送</p> <p>​		==rh_inherit_company.py==：输入公司名称，获取帐无忧对应的客户编号用于同步接口</p> <p>​		==rh_kingdee_category.py==：金蝶票据类型和凭证模版存放的模型表</p> <p>​		<code>金蝶配置</code>是通过yaml文件导入生成的</p> <p>​	4.<code>wizard</code></p> <p>​		push_account_sheet_wizard.py ：费用推送向导</p> <p>​		push_expense_sheet_wizard.py：收付款向导</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">Kingdee_Port_set</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">test_kingdee_connection</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token comment">#测试链接并将token保存到redis当中</span>
    <span class="token keyword">def</span> <span class="token function">check_redis_token</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token comment">#检查toke能有效性，有则获取，无则重新调用test_kingdee_connection</span>
    <span class="token keyword">def</span> <span class="token function">get_kingdee_category</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token comment">#获取票据类型</span>
    <span class="token keyword">def</span> <span class="token function">get_account_rule</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token comment">#获取凭证模版</span>
    <span class="token keyword">def</span> <span class="token function">batch_push_documents</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token comment">#推送单据到帐无忧智能记账</span>
    <span class="token keyword">def</span> <span class="token function">get_report_account</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token comment">#获取银行科目</span>
    
</code></pre></div><h3 id="百度行政编吗"><a href="#百度行政编吗" class="header-anchor">#</a> 百度行政编吗</h3> <p>​	1.<code>Models</code>:address_maintenance.py</p> <p>​		调取APi接口，分别为省、市、区、乡镇街道(目前只有北京和上海)写入名称和行政编吗</p> <p>​	2.<code>Views</code>:address_import.xml</p> <p>​		限制原模型的创建修改</p> <h3 id="短信平台"><a href="#短信平台" class="header-anchor">#</a> 短信平台</h3> <p>​	1.<code>Models</code>:compressed_link.py</p> <p>​		大汉三通短链接 def set_short_url</p> <p>​		inherit_workflow_config_settings.py 继承基础配置模型，写入短信URL，账号、密码</p> <p>​		send_message.py ：短信模版和接口调用</p> <h3 id="自由签"><a href="#自由签" class="header-anchor">#</a> 自由签</h3> <p>1.<code>Models</code></p> <p>​	<code>Fields</code>:sign_process_id :签署流程ID，signatory_ids：签署方列表，current_signatory_id：当前签署人，</p> <p>​	history_signatory_id：发起签署的人（第一）</p> <ul><li>==free_sale.py==:电子签约添加签署方</li></ul> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">init_send_sign_msg</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token comment">#当前签署人必须是企业当前签署人，初始化签署的环境，`多签`必须法人确认短信，`单签`无需确认</span>
    <span class="token keyword">if</span> party_partner_obj<span class="token punctuation">.</span>org_id<span class="token punctuation">.</span><span class="token builtin">id</span> <span class="token operator">!=</span> <span class="token boolean">False</span><span class="token punctuation">:</span> <span class="token comment">#代表企业签署</span>
        <span class="token keyword">if</span> sign_partner_obj<span class="token punctuation">.</span><span class="token builtin">id</span> <span class="token operator">!=</span> legal_person_partner_obj<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">:</span> <span class="token comment">#当前签署人不是法人</span>
            flag <span class="token operator">=</span> <span class="token boolean">True</span>
            <span class="token keyword">if</span> signing_method <span class="token operator">==</span> <span class="token string">'multi_signature'</span><span class="token punctuation">:</span> <span class="token comment">#多签</span>
                party_obj<span class="token punctuation">.</span>auth_state <span class="token operator">=</span> <span class="token string">'start_auth'</span>
                result <span class="token operator">=</span> tool<span class="token punctuation">.</span>send_msg_to_legal_person_for_sign<span class="token punctuation">(</span>model_str<span class="token punctuation">,</span> record_id<span class="token punctuation">,</span> party_obj<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">,</span>time_stamp<span class="token punctuation">,</span> sign_partner_obj<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        party_obj<span class="token punctuation">.</span>auth_state <span class="token operator">=</span> <span class="token string">'person'</span> <span class="token comment">#个人签署</span>
                                                                

<span class="token keyword">def</span> <span class="token function">send_sign_msg</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token comment">#发起签约调用e签宝静默签署	 </span>
                   flow_num<span class="token punctuation">,</span>body_json<span class="token operator">=</span>util<span class="token punctuation">.</span>util_send_sale_signature<span class="token punctuation">(</span>data<span class="token punctuation">,</span>name<span class="token punctuation">,</span>sign_list<span class="token punctuation">,</span><span class="token string">'sign_free_sale'</span><span class="token punctuation">,</span>model<span class="token operator">=</span><span class="token string">'free.sale'</span><span class="token punctuation">,</span>record_id<span class="token operator">=</span>self<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">)</span> <span class="token comment">#构造签署方列表所需的环境变量</span>
        field_list <span class="token operator">=</span> handler<span class="token punctuation">.</span>find_sign_field_based_on_flow_num<span class="token punctuation">(</span>flow_num<span class="token operator">=</span>flow_num<span class="token punctuation">,</span>lighthouse<span class="token operator">=</span>lighthouse<span class="token punctuation">)</span>
        
</code></pre></div><ul><li><p>==def send_sign_msg==：为自由签分类为，单签和多签，在XML context中默认<code>def create_signer</code>单签自动带出当前公司的当前签署人，<code>def action_opt_sign_warning</code>没有签署人弹出提醒 ，<code>def do_submit</code>直接创建签署方，<code>notify_signer_msg</code>:走完审批流发送短信</p></li> <li><p><code>single_sign.py</code>: 字段：signing_method ：【'single_sign':单签，'multi_signature':多签】</p> <p><code>def create_signer</code>:单签自动创建签署方列表方法</p> <p><code>def _compute_belong_singer</code>:根据current_signatory_id,判断当前签署人和登录id是否一致</p></li> <li><p><code>free_sign_popup_reminder.py</code>:签署方列表为空时，弹出向导的wizard方法</p></li></ul> <p>2.<code>Controllers</code></p> <p>​	==controllers.py==: <code>/sign/process/free_sale</code>这个路由是用来自由签署回调，更改本地的状态</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">5/14/2023, 12:30:43 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/超高清能力/搬迁组件说明文档.html" class="prev">
        搬迁组件说明文档
      </a></span> <span class="next"><a href="/超高清能力/DTing VQMT VQA部署常见问题.html">
        DTing VQMT VQA部署常见问题
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.449b22a3.js" defer></script><script src="/assets/js/2.559d5401.js" defer></script><script src="/assets/js/15.ec9227b5.js" defer></script>
  </body>
</html>
