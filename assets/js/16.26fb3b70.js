(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{287:function(t,s,a){"use strict";a.r(s);var n=a(14),r=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"搬迁组件说明文档"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#搬迁组件说明文档"}},[t._v("#")]),t._v(" 搬迁组件说明文档")]),t._v(" "),s("p",[t._v("1.启动rabbitmq，修改fds/conf/app.conf,修改对应的addr")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2022/02/24/zXJfampLu9PFk5v.png",alt:"image-20220224150804030"}})]),t._v(" "),s("ol",{attrs:{start:"2"}},[s("li",[s("p",[t._v("目录结构")]),t._v(" "),s("p",[t._v("base：通用基础的方法")]),t._v(" "),s("p",[t._v("conf：配置文件")]),t._v(" "),s("p",[t._v("migu_msg:rabbitmq封装的方法体")]),t._v(" "),s("p",[t._v("models: 模型及函数方法")]),t._v(" "),s("p",[t._v("Vender: 本地缓存的所需的依赖项")])]),t._v(" "),s("li",[s("p",[t._v("启动流程 bee run 或直接运行fds 可执行文件，首先解析命令行参数，然后beego加载app.conf ，运行boot.go 初始化参数、日志、MQ，然后运行监听MQ任务消息，当task.TransferType ==1  走HLS 下载，")]),t._v(" "),s("p",[t._v("task.TransferType  == 2时，判断消息体TransferContentURL内是否含有sftp，有则走SFTPFileDownload(),否则走FtpFileDownload(),消息结构体包含以下字段")]),t._v(" "),s("div",{staticClass:"language-go extra-class"},[s("pre",{pre:!0,attrs:{class:"language-go"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" ResultJson "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tTaskId     \t\t\t"),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:"taskId"`')]),t._v("   "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//任务ID")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('//TaskType\t\t\tstring `json:"taskType"`  ')]),t._v("\n\tResultCode \t\t\t"),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:"resultCode"`')]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//状态码 000表示成功")]),t._v("\n\tResultMsg  \t\t\t"),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:"resultMsg"`')]),t._v("   "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//返回描述信息")]),t._v("\n\tOpr        \t\t\t"),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:"opr"`')]),t._v("   "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 1表示搬迁开始，2表示搬迁完成")]),t._v("\n\tResponseTime       \t"),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:"responseTime"`')]),t._v("\n\tMd5Str\t\t\t\t"),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:"md5Str"`')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])]),t._v(" "),s("p",[t._v("4.DRMhls download 请求文件的m3u8URL，下载先命名为xxx.tmp,出现失败会删除临时文件，正常解析m3u8，隐藏http，然后一次解析下载ts，flowhlsdownload 会将大ts进行分片下载，根据结束符停止，最终将m3u8改名为正式名")]),t._v(" "),s("p",[t._v("搬迁任务消息体方法SendChan()调用SendCarryFileInjTaskMq")]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n \t"),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"taskId"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"11"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"transferContentURL"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://36.155.98.99:10085/testLiveC/livet/540p/250/index.m3u8"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"transferStoreURL"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/opt/temp/index.m3u8"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//存储位置")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"transferType"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"md5Gen"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"false"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"hlsType"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])}),[],!1,null,null,null);s.default=r.exports}}]);